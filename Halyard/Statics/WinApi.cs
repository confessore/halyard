using System;
using System.Runtime.InteropServices;

namespace Halyard.Statics
{
    static class WinApi
    {
        [DllImport("kernel32.dll")]
        public static extern IntPtr OpenProcess(int dwDesiredAccess, bool bInheritHandle, int dwProcessId);

        [DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        public static extern IntPtr GetModuleHandle(string lpModuleName);

        [DllImport("kernel32", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]
        public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);

        [DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]
        public static extern IntPtr VirtualAllocEx(IntPtr hProcess, IntPtr lpAddress,
            uint dwSize, uint flAllocationType, uint flProtect);

        [DllImport("kernel32.dll", SetLastError = true)]
        public static extern bool WriteProcessMemory(IntPtr hProcess, IntPtr lpBaseAddress, byte[] lpBuffer, uint nSize,
            out UIntPtr lpNumberOfBytesWritten);

        [DllImport("kernel32.dll")]
        public static extern IntPtr CreateRemoteThread(IntPtr hProcess,
            IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter,
            uint dwCreationFlags, IntPtr lpThreadId);

        [DllImport("kernel32.dll", SetLastError = true)]
        public static extern IntPtr WaitForSingleObject(IntPtr hHandle, UInt32 dwMilliseconds);

        [DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]
        public static extern bool VirtualFreeEx(IntPtr hProcess, IntPtr lpAddress,
            uint dwSize, AllocationType dwFreeType);

        [DllImport("kernel32", SetLastError = true, CharSet = CharSet.Ansi)]
        public static extern IntPtr LoadLibrary([MarshalAs(UnmanagedType.LPStr)] string lpFileName);

        [DllImport("kernel32.dll", SetLastError = true)]
        [return: MarshalAs(UnmanagedType.Bool)]
        public static extern bool FreeLibrary(IntPtr hModule);


        [Flags]
        public enum AllocationType
        {
            Commit = 0x1000,
            Reserve = 0x2000,
            Decommit = 0x4000,
            Release = 0x8000,
            Reset = 0x80000,
            Physical = 0x400000,
            TopDown = 0x100000,
            WriteWatch = 0x200000,
            LargePages = 0x20000000
        }

        // privileges
        public const int PROCESS_CREATE_THREAD = 0x0002;
        public const int PROCESS_QUERY_INFORMATION = 0x0400;
        public const int PROCESS_VM_OPERATION = 0x0008;
        public const int PROCESS_VM_WRITE = 0x0020;
        public const int PROCESS_VM_READ = 0x0010;

        // used for memory allocation
        public const uint MEM_COMMIT = 0x00001000;
        public const uint MEM_RESERVE = 0x00002000;
        public const uint PAGE_READWRITE = 4;
        //[DllImport("kernel32.dll")]
        //public static extern IntPtr OpenProcess(int dwDesiredAccess, bool bInheritHandle, int dwProcessId);

        //[DllImport("kernel32.dll", CharSet = CharSet.Auto)]
        //public static extern IntPtr GetModuleHandle(string lpModuleName);

        //[DllImport("kernel32.dll", CharSet = CharSet.Auto, ExactSpelling = true, SetLastError = true)]
        //public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);

        //[DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]
        //public static extern IntPtr VirtualAllocEx(IntPtr hProcess, IntPtr lpAddress,
        //    uint dwSize, uint flAllocationType, uint flProtect);

        //[DllImport("kernel32.dll", SetLastError = true)]
        //public static extern bool WriteProcessMemory(IntPtr hProcess, IntPtr lpBaseAddress, byte[] lpBuffer, uint nSize,
        //    out UIntPtr lpNumberOfBytesWritten);

        //[DllImport("kernel32.dll")]
        //public static extern IntPtr CreateRemoteThread(IntPtr hProcess,
        //    IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter,
        //    uint dwCreationFlags, IntPtr lpThreadId);

        //[DllImport("kernel32.dll", SetLastError = true)]
        //public static extern IntPtr WaitForSingleObject(IntPtr hHandle, uint dwMilliseconds);

        //[DllImport("kernel32.dll", SetLastError = true, ExactSpelling = true)]
        //public static extern bool VirtualFreeEx(IntPtr hProcess, IntPtr lpAddress,
        //    uint dwSize, AllocationType dwFreeType);

        //[DllImport("kernel32.dll", SetLastError = true, CharSet = CharSet.Auto)]
        //public static extern IntPtr LoadLibrary([MarshalAs(UnmanagedType.LPWStr)] string lpFileName);

        //[DllImport("kernel32.dll", SetLastError = true)]
        //[return: MarshalAs(UnmanagedType.Bool)]
        //public static extern bool FreeLibrary(IntPtr hModule);


        //[Flags]
        //public enum AllocationType
        //{
        //    Commit = 0x1000,
        //    Reserve = 0x2000,
        //    Decommit = 0x4000,
        //    Release = 0x8000,
        //    Reset = 0x80000,
        //    Physical = 0x400000,
        //    TopDown = 0x100000,
        //    WriteWatch = 0x200000,
        //    LargePages = 0x20000000
        //}

        //public const int PROCESS_CREATE_THREAD = 0x0002;
        //public const int PROCESS_QUERY_INFORMATION = 0x0400;
        //public const int PROCESS_VM_OPERATION = 0x0008;
        //public const int PROCESS_VM_WRITE = 0x0020;
        //public const int PROCESS_VM_READ = 0x0010;

        //public const uint MEM_COMMIT = 0x00001000;
        //public const uint MEM_RESERVE = 0x00002000;
        //public const uint PAGE_READWRITE = 4;
    }
}
